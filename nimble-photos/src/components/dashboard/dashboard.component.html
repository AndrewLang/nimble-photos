<div class="flex flex-1 overflow-hidden bg-slate-950">

    <aside class="w-full border-b border-white/5 bg-slate-900/70 p-5 md:w-60 md:border-b-0 md:border-r md:p-6">
        <p class="text-[0.6rem] font-semibold uppercase tracking-[0.5em] text-slate-500">Sections</p>
        <div class="mt-4 space-y-2">
            <div *ngIf="!navSections().length" class="text-xs text-slate-500">No sections available.</div>
            <button
                *ngFor="let section of navSections()"
                type="button"
                class="flex w-full flex-col justify-between rounded-2xl border border-white/5 bg-slate-950/80 px-4 py-3 text-left text-xs font-semibold uppercase tracking-[0.3em] transition hover:border-indigo-500"
                [class.border-indigo-500]="selectedSection() === section.section"
                [class.text-white]="selectedSection() === section.section"
                [class.text-slate-400]="selectedSection() !== section.section"
                (click)="selectSection(section.section)"
            >
                <span>{{ section.label }}</span>
                <span class="text-[10px] font-normal uppercase tracking-[0.2em] text-slate-400">
                    {{ section.count }} setting{{ section.count === 1 ? '' : 's' }}
                </span>
            </button>
        </div>
    </aside>

    <section class="flex-1 overflow-y-auto px-6 py-6 md:px-10">
        <div *ngIf="loading()" class="flex h-full items-center justify-center">
            <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">Loading settings…</p>
        </div>

        <div *ngIf="error()" class="rounded-2xl border border-rose-500/40 bg-rose-500/5 px-5 py-4 text-sm text-rose-400">
            {{ error() }}
        </div>

        <div *ngIf="!loading() && !sectionSettings().length" class="rounded-2xl border border-white/5 bg-slate-900/50 p-6 text-sm text-slate-400">
            No settings are available for this section yet.
        </div>

        <div class="space-y-5" *ngIf="!loading()">
            <div *ngFor="let setting of sectionSettings()" class="rounded-3xl border border-white/5 bg-slate-900/60 p-5 shadow-[0_10px_40px_rgba(2,6,23,0.8)]">
                <div class="flex items-center justify-between gap-4">
                    <div>
                        <p class="text-[0.6rem] font-semibold uppercase tracking-[0.5em] text-slate-500">
                            {{ setting.sectionLabel }}
                        </p>
                        <h3 class="text-lg font-semibold text-white">{{ setting.label }}</h3>
                    </div>
                    <span class="text-[10px] font-semibold uppercase tracking-[0.3em] text-slate-400">
                        {{ setting.valueType }}
                    </span>
                </div>

                <p class="mt-2 text-sm text-slate-400">{{ setting.description }}</p>

                <div class="mt-4 space-y-3">
                    <ng-container *ngIf="setting.valueType === 'boolean'; else valueControl">
                        <button
                            type="button"
                            (click)="toggleBoolean(setting)"
                            class="inline-flex items-center justify-center gap-2 rounded-full border border-white/10 px-5 py-2 text-[11px] font-bold uppercase tracking-[0.3em] transition"
                            [class.bg-emerald-500/15]="isSettingEnabled(setting)"
                            [class.text-emerald-400]="isSettingEnabled(setting)"
                            [class.border-emerald-400]="isSettingEnabled(setting)"
                            [class.bg-white/5]="!isSettingEnabled(setting)"
                        >
                            {{ isSettingEnabled(setting) ? 'Enabled' : 'Disabled' }}
                            <span class="text-[9px] uppercase tracking-[0.4em] text-slate-400">
                                {{ isSettingEnabled(setting) ? 'On' : 'Off' }}
                            </span>
                        </button>
                    </ng-container>

                    <ng-template #valueControl>
                        <div *ngIf="setting.options?.length; else typedField">
                            <select
                                [ngModel]="getLocalValue(setting.key)"
                                (ngModelChange)="setLocalValue(setting.key, $event)"
                                class="w-full rounded-2xl border border-white/10 bg-slate-950/70 px-4 py-2 text-sm text-white outline-none transition focus:border-indigo-500"
                            >
                                <option *ngFor="let option of setting.options" [ngValue]="option.value">
                                    {{ option.label }}
                                </option>
                            </select>
                        </div>

                        <ng-template #typedField>
                            <ng-container [ngSwitch]="setting.valueType">
                                <textarea
                                    *ngSwitchCase="'json'"
                                    rows="4"
                                    [ngModel]="getLocalValue(setting.key)"
                                    (ngModelChange)="setLocalValue(setting.key, $event)"
                                    class="w-full rounded-2xl border border-white/10 bg-slate-950/70 px-4 py-3 text-sm text-white outline-none focus:border-indigo-500"
                                ></textarea>
                                <input
                                    *ngSwitchCase="'number'"
                                    type="number"
                                    [ngModel]="getLocalValue(setting.key)"
                                    (ngModelChange)="setLocalValue(setting.key, $event)"
                                    class="w-full rounded-2xl border border-white/10 bg-slate-950/70 px-4 py-2 text-sm text-white outline-none focus:border-indigo-500"
                                />
                                <input
                                    *ngSwitchDefault
                                    type="text"
                                    [ngModel]="getLocalValue(setting.key)"
                                    (ngModelChange)="setLocalValue(setting.key, $event)"
                                    class="w-full rounded-2xl border border-white/10 bg-slate-950/70 px-4 py-2 text-sm text-white outline-none focus:border-indigo-500"
                                />
                            </ng-container>
                        </ng-template>
                    </ng-template>
                </div>

                <div class="mt-4 flex items-center gap-3">
                    <button
                        type="button"
                        (click)="saveSetting(setting)"
                        [disabled]="saving()[setting.key]"
                        class="rounded-full border border-white/10 bg-indigo-600 px-4 py-2 text-[10px] font-bold uppercase tracking-[0.35em] text-white transition hover:bg-indigo-500 disabled:opacity-40 disabled:cursor-not-allowed"
                    >
                        {{ saving()[setting.key] ? 'Saving…' : 'Save' }}
                    </button>
                    <p *ngIf="saveSuccess()[setting.key]" class="text-[10px] font-semibold uppercase tracking-[0.4em] text-emerald-400">
                        Saved
                    </p>
                    <p *ngIf="fieldErrors()[setting.key]" class="text-[10px] text-rose-400">
                        {{ fieldErrors()[setting.key] }}
                    </p>
                </div>
            </div>
        </div>
    </section>
</div>
