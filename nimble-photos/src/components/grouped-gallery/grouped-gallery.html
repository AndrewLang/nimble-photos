<div class="relative flex flex-1 flex-col overflow-hidden h-full">
    <div class="timeline-ruler">
        @for (group of groups(); track group.title) {
        <div class="timeline-item" [class.active]="activeGroupTitle() === group.title"
            (click)="scrollToGroup(group.title)">
            <span class="timeline-year">{{ group.title.split('-')[0] }}</span>
            <span class="timeline-month">{{ getMonthName(group.title.split('-')[1]) }}</span>
            <div class="timeline-line"></div>
        </div>
        }
    </div>

    <div class="scroll-container" (scroll)="onScroll($event)">
        @for (group of groups(); track group.title) {
        <section class="group-section" [id]="'group-' + group.title">
            <div class="group-header sticky top-0 z-30 pt-4 pb-2" [id]="'group-header-' + group.title">
                <h2 class="group-title text-2xl font-bold tracking-tight text-white/90 drop-shadow-md">{{
                    group.title }}</h2>
            </div>

            <div class="masonry-grid">
            @for (photo of group.photos.items; track photo.id) {
            <article [routerLink]="['/photo', photo.id]" class="photo-card cursor-pointer"
                [style.backgroundImage]="'linear-gradient(180deg, rgba(2,6,23,0) 0%, rgba(2,6,23,0.2) 50%, rgba(2,6,23,0.9) 100%), url(' + getImageUrl(photo) + ')'"
                [style.aspectRatio]="getAspectRatio(photo)">
                <div class="photo-content">
                    <div class="mt-auto">
                        <p class="photo-title text-lg leading-tight mb-1">{{ photo.name }}</p>
                        <div
                            class="photo-meta flex gap-3 text-[0.65rem] tracking-wider uppercase text-slate-400 font-medium">
                            <span>{{ photo.dateTaken ? (photo.dateTaken | date:'mediumDate') : 'Unknown date' }}</span>
                            <span *ngIf="photo.format">{{ photo.format.toUpperCase() }}</span>
                        </div>
                        <div class="photo-meta flex gap-3 text-[0.65rem] tracking-wider uppercase text-slate-400 font-medium mt-1">
                            <span *ngIf="photo.metadata?.location">{{ photo.metadata?.location }}</span>
                        </div>
                    </div>
                </div>
            </article>
            }
            </div>
        </section>
        }

        <div class="gallery-status flex justify-center py-8 text-sm text-slate-500 font-medium tracking-wide">
            @if (loading()) {
            <span class="animate-pulse">Loading timeline...</span>
            }
            @else if (groups().length === 0) {
            <span>No photos found.</span>
            }
        </div>
    </div>
</div>
